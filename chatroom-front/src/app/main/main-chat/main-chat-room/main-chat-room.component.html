@if (room()) {
<div class="text-gray-600 text-xs w-full r-[24px]">
	<div
		class="bg-blue-500 rounded-tl rounded-tr text-white cursor-pointer py-4 px-6 flex justify-between items-center"
		(click)="toggleOpen()"
	>
		<h4 class="text-base leading-snug m-0">{{ room()!.name }}</h4>
		<button
			class="flex items-center rounded-full p-2 text-white aspect-square text-base leading-none text-center bg-blue-500 hover:bg-blue-400"
			(click)="leave()"
		>
			<svg
				xmlns="http://www.w3.org/2000/svg"
				fill="none"
				viewBox="0 0 24 24"
				stroke-width="1.5"
				stroke="currentColor"
				class="size-6"
			>
				<path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
			</svg>
		</button>
	</div>

	@if (open()) {
	<div class="bg-white flex flex-col gap-1">
		<div class="flex border-b border-gray-200">
			<button
				class="flex-1 py-2 px-4 text-sm font-medium {{
					view() === 'messages' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500 hover:text-gray-700'
				}}"
				(click)="view.set('messages')"
			>
				Messages
			</button>
			<button
				class="flex-1 py-2 px-4 text-sm font-medium {{
					view() === 'participants' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500 hover:text-gray-700'
				}}"
				(click)="view.set('participants')"
			>
				Participants ({{ participants().size }})
			</button>
		</div>

		@if (view() === 'messages') {
		<div #messagesContainer class="h-64 py-2 px-3 overflow-y-scroll flex flex-col gap-4">
			@for (message of messages(); track message.id){
			<app-main-chat-message
				[message]="message"
				[onEditMessage]="onEditMessage.bind(this, message)"
				[editing]="editMessage()?.id === message.id"
				[previousMessage]="$index > 0 ? messages()[$index - 1] : undefined"
			/>
			} @empty {
			<div class="text-center text-gray-500 py-4">Aucun message pour le moment</div>
			}
		</div>

		<form class="p-5" (submit)="sendMessage($event)">
			<fieldset class="relative border-0 m-0 p-0">
				@if (getTypingUsers().length > 0) {
				<div class="absolute -top-6 inset-x-0 text-sm text-gray-500 bg-white w-full">
					@if (getTypingUsers().length === 1) {
					{{ getTypingUsers()[0].email!.split('@')[0] }} est en train d'écrire... } @else { Plusieurs personnes sont en
					train d'écrire... }
				</div>
				}

				<input
					type="text"
					placeholder="Message"
					autofocus
					class="m-0 leading-none border border-solid border-gray-400 rounded w-full p-3 outline-none"
					[formControl]="messageToSend"
				/>
				<input type="hidden" />
			</fieldset>
		</form>
		} @if (view() === 'participants') {
		<div class="h-64 py-2 px-3 overflow-y-scroll">
			<div class="flex flex-col gap-2">
				@for (participant of participants().values(); track participant.id) {
				<div class="flex items-center gap-3 p-2 rounded hover:bg-gray-50">
					<img
						class="w-8 h-8 rounded-full bg-gray-200"
						[src]="getGravatarUrl(participant.email!)"
						[alt]="participant.email"
					/>
					<div class="flex-1">
						<p class="text-sm font-medium text-gray-900">
							{{ participant.email!.split('@')[0] }}
						</p>
						<p class="text-xs text-gray-500">
							{{ participant.email }}
						</p>
					</div>
				</div>
				}
			</div>
		</div>
		}
	</div>
	}
</div>
}
